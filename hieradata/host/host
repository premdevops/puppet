class monitoring {

#Hiera Lookups
$Service       = hiera('monitoring::iqservice')
$Service_path  = hiera('monitoring::iqsericepath')
$Jpath         = hiera('monitoring::jpath')
$port_no       = hiera('monitoring::iqport')
$MAILTO        = hiera('monitoring::mailto')
$mail_port     = hiera('monitoring::mailport')

service { $Service :

        ensure  => running,
        hasstatus => false,
        }

exec { 'portcheck':
      path   => $Jpath,
      command => "$Service_path restart ; $mail_port $MAILTO",
      onlyif => "test `netstat -ntlp | grep -i java | grep $port_no | wc -l` -eq 0",
      }

}

